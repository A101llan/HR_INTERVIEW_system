@model HR.Web.Models.QuestionAdminViewModel
@{
    ViewBag.Title = Model.Id.HasValue ? "Edit Question" : "Add Question";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <h2>@ViewBag.Title</h2>
    @using (Html.BeginForm()) {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.Id)
        <div class="form-group mb-3">
            @Html.LabelFor(m => m.Text, new { @class = "font-weight-bold" })
            @Html.TextBoxFor(m => m.Text, new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Text)
        </div>
        <div class="form-group mb-3">
            @Html.LabelFor(m => m.Type, new { @class = "font-weight-bold" })
            @{
                var typeOptions = HR.Web.Models.QuestionAdminViewModel.AllowedTypes;
            }
            @Html.DropDownListFor(
                m => m.Type,
                new SelectList(typeOptions, Model.Type),
                "-- Select question type --",
                new { @class = "form-control" })
        </div>
        <div class="form-check mb-3">
            @Html.CheckBoxFor(m => m.IsActive, new { @class = "form-check-input" })
            @Html.LabelFor(m => m.IsActive, new { @class = "form-check-label" })
        </div>

        <h4>Options/Choices</h4>
        <table class="table table-bordered">
            <thead><tr><th>Text</th><th>Points</th><th>Action</th></tr></thead>
            <tbody id="optionsTable">
            @for (int i = 0; i < Model.Options.Count; i++) {
                <tr>
                    <td>@Html.TextBoxFor(m => m.Options[i].Text, new { @class = "form-control" })</td>
                    <td>@Html.TextBoxFor(m => m.Options[i].Points, new { @class = "form-control", type = "number", step = "0.01" })</td>
                    <td><button type="button" class="btn btn-danger btn-sm" onclick="removeOption(this)">Remove</button></td>
                    @Html.HiddenFor(m => m.Options[i].Id)
                </tr>
            }
            </tbody>
        </table>
        <button id="addOptionBtn" type="button" class="btn btn-secondary mb-3">Add Option</button>

        <div>
            <button type="submit" class="btn btn-success">Save</button>
            <a href="@Url.Action("Questions", "Admin")" class="btn btn-link">Cancel</a>
        </div>
    }
</div>

@section Scripts {
<script>
function removeOption(btn) {
    var row = btn.closest('tr');
    if (row) row.parentNode.removeChild(row);
}

document.getElementById('addOptionBtn').addEventListener('click', function() {
    var table = document.getElementById('optionsTable');
    var row = document.createElement('tr');
    row.innerHTML = `<td><input class='form-control' type='text' name='Options[${table.rows.length}].Text' /></td><td><input class='form-control' type='number' step='0.01' name='Options[${table.rows.length}].Points' /></td><td><button type='button' class='btn btn-danger btn-sm' onclick='removeOption(this)'>Remove</button></td><input type='hidden' name='Options[${table.rows.length}].Id' value='' />`;
    table.appendChild(row);
});
</script>
}





